import React, { useRef, useLayoutEffect } from "react";
import gsap from "gsap";

export default function MarqueTrack(props) {
    const baseWidth = props.contentWidth ?? 240;
    const svgCount = props.count ?? 10;
    const svgContainer = useRef(null);

    useLayoutEffect(() => {
        let ctx = gsap.context(() => {
            marqueeInit();
        }, marqueeRef);

        return function () {
            ctx.revert();
        };
    });
    const marqueeRef = useRef(null);

    useLayoutEffect(() => {
        let ctx = gsap.context(() => {
            marqueeInit();
        }, marqueeRef);

        return function () {
            ctx.revert();
        };
    }, []);

    const marqueeInit = () => {
        gsap.set(svgContainer.current.children, {
            x: (i) => i * baseWidth,
        });

        gsap.to(svgContainer.current.children, {
            duration: props.duration ?? 30,
            ease: "none",
            x: `+=${baseWidth * svgCount}`, //move each box 500px to right
            modifiers: {
                x: gsap.utils.unitize((x) => parseFloat(x) % (baseWidth * svgCount)), //force x value to be between 0 and 500 using modulus
            },
            repeat: -1,
        });
    };

    return (
        <div
            ref={marqueeRef}
            className="marquee-wrapper"
            style={{
                minWidth: '0px',
                backgroundColor: 'white',
                width: "100%",
                ...props.sx,
                borderLeft: "2px solid black",
                borderRight: "2px solid black",
            }}
        >
            <div
                className="marque-track"
                style={{
                    height: "40px",
                    overflow: "hidden",
                    width: `${baseWidth * svgCount}px`,
                    padding: "10px 0px",
                    zIndex: 100,
                }}
            >
                <div
                    className="svgs "
                    style={{
                        position: "relative",
                        left: "-" + baseWidth + "px",
                        backgroundColor: "red",
                    }}
                    ref={svgContainer}
                >
                    {[...Array(svgCount)].map((_, index) => {
                        return <Svg key={"marque-item-" + index} baseWidth={baseWidth} />;
                    })}
                </div>
            </div>
        </div>
    );
}

const Svg = (props) => {
    return (
        <svg
            xmlns="http://www.w3.org/2000/svg"
            width={props.baseWidth - 15}
            viewBox="0 0 249 18"
            fill="none"
            className="svg-box horizontal-item"
            style={{
                marginRight: "15px",
            }}
        >
            <path
                d="M9.226 4.81132L5.54789 15.4245H4.28381L1.29919 3.62264L0 3.06604V2.66981H5.15286V3.06604L3.67811 3.60377L5.96925 12.9528H5.45133L8.91876 2.5566H10.2179L13.9751 13.1698L13.2465 13.3679L15.3445 3.60377L13.8961 3.06604V2.66981H17.6707V3.06604L16.4066 3.60377L13.6239 15.4245H12.3598L8.58518 4.99057L9.226 4.81132Z"
                fill="black"
            />
            <path
                d="M25.7584 6.20755V11.1509H24.9771L24.784 9.20755H20.588V8.15094H24.784L24.9771 6.20755H25.7584ZM28.111 6.30189L27.637 6.41509L25.8901 3.37736L26.5309 3.73585H20.588V2.66981H26.1798L27.2244 2.10377H27.4526L28.111 6.30189ZM26.1447 14.6132L28.0232 11.4057L28.4358 11.5283L27.7335 15.9528H27.4965L26.3729 15.3113H20.588V14.2453H26.6362L26.1447 14.6132ZM18.2354 15.3113V14.9151L19.5434 14.3868V3.59434L18.2354 3.06604V2.66981H21.8082V15.3113H18.2354Z"
                fill="black"
            />
            <path d="M38.6978 16H38.3993L37.2055 15.3113H31.9209V14.2453H37.9253L36.9772 14.6038L39.0489 11.1604L39.5054 11.283L38.6978 16ZM33.1411 3.59434V15.3113H29.5683V14.9151L30.8763 14.3868V3.59434L29.5683 3.06604V2.66981H34.4579V3.06604L33.1411 3.59434Z" fill="black" />
            <path
                d="M47.4488 14.4528C47.8467 14.4528 48.2271 14.4182 48.59 14.3491C48.9528 14.2736 49.342 14.1478 49.7575 13.9717L49.2396 14.3868L50.6968 11.6509H51.1883L50.8284 14.8208C50.3485 15.0409 49.778 15.2138 49.1167 15.3396C48.4554 15.4717 47.7472 15.5377 46.9923 15.5377C45.9623 15.5377 45.0318 15.3962 44.2008 15.1132C43.3756 14.8302 42.6705 14.4119 42.0852 13.8585C41.5 13.305 41.0523 12.6321 40.7422 11.8396C40.432 11.0409 40.2769 10.1289 40.2769 9.10377C40.2769 7.77044 40.5607 6.60377 41.1284 5.60377C41.6961 4.60377 42.5066 3.82704 43.56 3.27358C44.6134 2.72013 45.8716 2.4434 47.3347 2.4434C47.7034 2.4434 48.072 2.46855 48.4407 2.51887C48.8094 2.56289 49.2454 2.6478 49.7487 2.77358L49.1342 2.92453L50.2842 2.04717H50.5563L51.1357 6.62264L50.6353 6.73585L48.9323 3.69811L49.538 4.37736C49.064 4.0566 48.6221 3.83648 48.2125 3.71698C47.8087 3.59119 47.3786 3.5283 46.9221 3.5283C46.2257 3.5283 45.6112 3.63522 45.0786 3.84906C44.5461 4.0566 44.0984 4.36163 43.7356 4.76415C43.3786 5.16667 43.1064 5.66352 42.9192 6.25472C42.7319 6.84591 42.6383 7.52516 42.6383 8.29245C42.6383 9.31132 42.7553 10.2044 42.9894 10.9717C43.2293 11.7327 43.5658 12.3742 43.9989 12.8962C44.432 13.412 44.9411 13.8019 45.5263 14.066C46.1116 14.3239 46.7524 14.4528 47.4488 14.4528Z"
                fill="black"
            />
            <path
                d="M58.7235 2.4434C59.6131 2.4434 60.4236 2.60063 61.1551 2.91509C61.8925 3.22327 62.5275 3.66667 63.06 4.24528C63.5926 4.81761 64.0022 5.50629 64.289 6.31132C64.5816 7.11006 64.7279 7.99685 64.7279 8.9717C64.7279 9.94025 64.5757 10.827 64.2714 11.6321C63.973 12.4308 63.5487 13.1226 62.9986 13.7075C62.4485 14.2925 61.7989 14.7453 61.0498 15.066C60.3007 15.3805 59.4756 15.5377 58.5743 15.5377C57.6848 15.5377 56.8713 15.3836 56.1339 15.0755C55.4024 14.761 54.7704 14.3176 54.2378 13.7453C53.7053 13.1667 53.2927 12.4748 53.0001 11.6698C52.7133 10.8648 52.57 9.97799 52.57 9.00943C52.57 8.04088 52.7192 7.15723 53.0177 6.35849C53.322 5.55346 53.7492 4.85849 54.2993 4.27358C54.8494 3.68868 55.499 3.23899 56.2481 2.92453C56.9972 2.60377 57.8223 2.4434 58.7235 2.4434ZM58.7323 14.4245C59.4521 14.4245 60.0813 14.2358 60.6197 13.8585C61.1639 13.4748 61.5853 12.9119 61.8837 12.1698C62.188 11.4277 62.3402 10.5189 62.3402 9.4434C62.3402 8.16038 62.1793 7.08491 61.8574 6.21698C61.5355 5.34277 61.0908 4.68239 60.5231 4.23585C59.9554 3.78302 59.3029 3.5566 58.5655 3.5566C57.8457 3.5566 57.2137 3.74843 56.6694 4.13207C56.131 4.50943 55.7097 5.06918 55.4054 5.81132C55.1069 6.54717 54.9577 7.45597 54.9577 8.53774C54.9577 9.81447 55.1186 10.8899 55.4405 11.7642C55.7623 12.6384 56.2071 13.3019 56.7748 13.7547C57.3483 14.2013 58.0008 14.4245 58.7323 14.4245Z"
                fill="black"
            />
            <path
                d="M81.0159 14.3679L82.359 14.9151V15.3113H77.3466V14.9151L78.7248 14.4245L78.0401 4.41509L78.1542 4.43396L73.9406 15.4151H72.7116L68.3839 4.4717L68.498 4.45283L67.9538 14.3585L69.332 14.9151V15.3113H65.531V14.9151L66.918 14.3585L67.6202 3.66981L66.1981 3.06604V2.66981H70.1572L74.0898 12.783H73.8879L77.7943 2.66981H81.5338V3.06604L80.2083 3.59434L81.0159 14.3679Z"
                fill="black"
            />
            <path
                d="M90.8242 6.20755V11.1509H90.0429L89.8498 9.20755H85.6537V8.15094H89.8498L90.0429 6.20755H90.8242ZM93.1767 6.30189L92.7027 6.41509L90.9558 3.37736L91.5966 3.73585H85.6537V2.66981H91.2455L92.2901 2.10377H92.5184L93.1767 6.30189ZM91.2104 14.6132L93.089 11.4057L93.5015 11.5283L92.7993 15.9528H92.5623L91.4386 15.3113H85.6537V14.2453H91.702L91.2104 14.6132ZM83.3011 15.3113V14.9151L84.6091 14.3868V3.59434L83.3011 3.06604V2.66981H86.8739V15.3113H83.3011Z"
                fill="black"
            />
            <path
                d="M102 3.27358H104.265V14.3868L105.573 14.9151V15.3113H100.692V14.9151L102 14.3868V3.27358ZM107.671 3.73585H98.4451L99.4546 3.46226L98.0413 6.33962L97.5409 6.22641L97.9008 2H98.1642L99.5775 2.86792L98.647 2.66981H107.469L106.749 2.86792L108.163 2H108.426L108.786 6.22641L108.286 6.33962L106.872 3.46226L107.671 3.73585Z"
                fill="black"
            />
            <path
                d="M115.731 2.4434C116.621 2.4434 117.431 2.60063 118.163 2.91509C118.9 3.22327 119.535 3.66667 120.068 4.24528C120.6 4.81761 121.01 5.50629 121.297 6.31132C121.589 7.11006 121.735 7.99685 121.735 8.9717C121.735 9.94025 121.583 10.827 121.279 11.6321C120.98 12.4308 120.556 13.1226 120.006 13.7075C119.456 14.2925 118.806 14.7453 118.057 15.066C117.308 15.3805 116.483 15.5377 115.582 15.5377C114.692 15.5377 113.879 15.3836 113.141 15.0755C112.41 14.761 111.778 14.3176 111.245 13.7453C110.713 13.1667 110.3 12.4748 110.008 11.6698C109.721 10.8648 109.577 9.97799 109.577 9.00943C109.577 8.04088 109.727 7.15723 110.025 6.35849C110.329 5.55346 110.757 4.85849 111.307 4.27358C111.857 3.68868 112.507 3.23899 113.256 2.92453C114.005 2.60377 114.83 2.4434 115.731 2.4434ZM115.74 14.4245C116.46 14.4245 117.089 14.2358 117.627 13.8585C118.171 13.4748 118.593 12.9119 118.891 12.1698C119.196 11.4277 119.348 10.5189 119.348 9.4434C119.348 8.16038 119.187 7.08491 118.865 6.21698C118.543 5.34277 118.098 4.68239 117.531 4.23585C116.963 3.78302 116.31 3.5566 115.573 3.5566C114.853 3.5566 114.221 3.74843 113.677 4.13207C113.139 4.50943 112.717 5.06918 112.413 5.81132C112.114 6.54717 111.965 7.45597 111.965 8.53774C111.965 9.81447 112.126 10.8899 112.448 11.7642C112.77 12.6384 113.215 13.3019 113.782 13.7547C114.356 14.2013 115.008 14.4245 115.74 14.4245Z"
                fill="black"
            />
            <path
                d="M141.967 14.3679L143.31 14.9151V15.3113H138.297V14.9151L139.676 14.4245L138.991 4.41509L139.105 4.43396L134.892 15.4151H133.663L129.335 4.4717L129.449 4.45283L128.905 14.3585L130.283 14.9151V15.3113H126.482V14.9151L127.869 14.3585L128.571 3.66981L127.149 3.06604V2.66981H131.108L135.041 12.783H134.839L138.745 2.66981H142.485V3.06604L141.159 3.59434L141.967 14.3679Z"
                fill="black"
            />
            <path
                d="M144.7 3.62264L143.436 3.06604V2.66981H148.834V3.06604L147.395 3.60377L151.046 9.22641L150.423 9.19811L153.408 3.60377L152.021 3.06604V2.66981H155.848V3.06604L154.584 3.60377L151.09 9.73585V14.3868L152.398 14.9151V15.3113H147.518V14.9151L148.826 14.3868V9.77358L144.7 3.62264Z"
                fill="black"
            />
            <path
                d="M167.196 6.53774V11.4811H166.415L166.222 9.53773H162.096V8.4717H166.222L166.415 6.53774H167.196ZM168.486 2.10377H168.688L169.347 6.30189L168.873 6.41509L167.126 3.37736L168.162 3.73585H161.92V2.66981H167.433L168.486 2.10377ZM163.29 2.66981V14.3868L164.606 14.9151V15.3113H159.717V14.9151L161.025 14.3868V3.59434L159.717 3.06604V2.66981H163.29Z"
                fill="black"
            />
            <path
                d="M176.219 2.4434C177.109 2.4434 177.919 2.60063 178.651 2.91509C179.388 3.22327 180.023 3.66667 180.556 4.24528C181.088 4.81761 181.498 5.50629 181.785 6.31132C182.077 7.11006 182.223 7.99685 182.223 8.9717C182.223 9.94025 182.071 10.827 181.767 11.6321C181.468 12.4308 181.044 13.1226 180.494 13.7075C179.944 14.2925 179.294 14.7453 178.545 15.066C177.796 15.3805 176.971 15.5377 176.07 15.5377C175.18 15.5377 174.367 15.3836 173.629 15.0755C172.898 14.761 172.266 14.3176 171.733 13.7453C171.201 13.1667 170.788 12.4748 170.496 11.6698C170.209 10.8648 170.065 9.97799 170.065 9.00943C170.065 8.04088 170.215 7.15723 170.513 6.35849C170.817 5.55346 171.245 4.85849 171.795 4.27358C172.345 3.68868 172.995 3.23899 173.744 2.92453C174.493 2.60377 175.318 2.4434 176.219 2.4434ZM176.228 14.4245C176.948 14.4245 177.577 14.2358 178.115 13.8585C178.659 13.4748 179.081 12.9119 179.379 12.1698C179.684 11.4277 179.836 10.5189 179.836 9.4434C179.836 8.16038 179.675 7.08491 179.353 6.21698C179.031 5.34277 178.586 4.68239 178.019 4.23585C177.451 3.78302 176.798 3.5566 176.061 3.5566C175.341 3.5566 174.709 3.74843 174.165 4.13207C173.627 4.50943 173.205 5.06918 172.901 5.81132C172.602 6.54717 172.453 7.45597 172.453 8.53774C172.453 9.81447 172.614 10.8899 172.936 11.7642C173.258 12.6384 173.703 13.3019 174.27 13.7547C174.844 14.2013 175.496 14.4245 176.228 14.4245Z"
                fill="black"
            />
            <path d="M192.541 16H192.242L191.049 15.3113H185.764V14.2453H191.768L190.82 14.6038L192.892 11.1604L193.349 11.283L192.541 16ZM186.984 3.59434V15.3113H183.412V14.9151L184.719 14.3868V3.59434L183.412 3.06604V2.66981H188.301V3.06604L186.984 3.59434Z" fill="black" />
            <path d="M199.12 14.9151V15.3113H194.23V14.9151L195.538 14.3868V3.59434L194.23 3.06604V2.66981H199.12V3.06604L197.803 3.59434V14.3868L199.12 14.9151Z" fill="black" />
            <path
                d="M206.463 2.4434C207.353 2.4434 208.163 2.60063 208.895 2.91509C209.632 3.22327 210.267 3.66667 210.8 4.24528C211.332 4.81761 211.742 5.50629 212.029 6.31132C212.321 7.11006 212.467 7.99685 212.467 8.9717C212.467 9.94025 212.315 10.827 212.011 11.6321C211.712 12.4308 211.288 13.1226 210.738 13.7075C210.188 14.2925 209.538 14.7453 208.789 15.066C208.04 15.3805 207.215 15.5377 206.314 15.5377C205.424 15.5377 204.611 15.3836 203.873 15.0755C203.142 14.761 202.51 14.3176 201.977 13.7453C201.445 13.1667 201.032 12.4748 200.74 11.6698C200.453 10.8648 200.309 9.97799 200.309 9.00943C200.309 8.04088 200.459 7.15723 200.757 6.35849C201.061 5.55346 201.489 4.85849 202.039 4.27358C202.589 3.68868 203.238 3.23899 203.988 2.92453C204.737 2.60377 205.562 2.4434 206.463 2.4434ZM206.472 14.4245C207.192 14.4245 207.821 14.2358 208.359 13.8585C208.903 13.4748 209.325 12.9119 209.623 12.1698C209.928 11.4277 210.08 10.5189 210.08 9.4434C210.08 8.16038 209.919 7.08491 209.597 6.21698C209.275 5.34277 208.83 4.68239 208.263 4.23585C207.695 3.78302 207.042 3.5566 206.305 3.5566C205.585 3.5566 204.953 3.74843 204.409 4.13207C203.871 4.50943 203.449 5.06918 203.145 5.81132C202.846 6.54717 202.697 7.45597 202.697 8.53774C202.697 9.81447 202.858 10.8899 203.18 11.7642C203.502 12.6384 203.947 13.3019 204.514 13.7547C205.088 14.2013 205.74 14.4245 206.472 14.4245Z"
                fill="black"
            />
            <path
                d="M214.683 12.6981C215.064 12.6981 215.377 12.8333 215.623 13.1038C215.874 13.3742 216 13.7013 216 14.0849C216 14.4748 215.874 14.805 215.623 15.0755C215.377 15.3459 215.064 15.4811 214.683 15.4811C214.303 15.4811 213.987 15.3459 213.735 15.0755C213.484 14.805 213.358 14.4748 213.358 14.0849C213.358 13.7013 213.484 13.3742 213.735 13.1038C213.987 12.8333 214.303 12.6981 214.683 12.6981Z"
                fill="black"
            />
            <path d="M240 0L241.316 5.82398L246.364 2.63604L243.176 7.68445L249 9L243.176 10.3155L246.364 15.364L241.316 12.176L240 18L238.684 12.176L233.636 15.364L236.824 10.3155L231 9L236.824 7.68445L233.636 2.63604L238.684 5.82398L240 0Z" fill="black" />
        </svg>
    );
};
